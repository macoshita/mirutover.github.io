---
layout: post
title: Python で markdown から html を生成する 〜シンタックスハイライトもあるよ〜
date: 2013-01-13 15:58:45 UTC
updated: 2013-01-13 15:58:45 UTC
comments: false
categories: blog
tags: Python Markdown
---

<p><a href="http://mirutover.blogspot.jp/2013/01/blog-post_10.html">あけおめブログ</a>で書いたけど markdown で書いて html を生成してコピペする方法に移行している。でも、過去のブログは２つとも mou というアプリで cmd + option + C で html をコピペできちゃうので、それで書いていた。</p><p>しかし、シンタックスハイライトについて、いままでは <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a> という有名なスクリプトを使っていたんだけど、どうも blogger に適用するのはやり方がスマートじゃなくて、かつ script で動的にやってるから若干重いような気もしていた。</p><h2>Python の markdown モジュール</h2><p>そこで html を生成するときにえいやっとシンタックスハイライトする方法はないか調べていたら、python の <a href="http://packages.python.org/Markdown/">markdown</a> モジュールに <a href="http://packages.python.org/Markdown/extensions/code_hilite.html">CodeHilite</a> という extension があるじゃないか。</p><p>さらに、そいつが中で利用している <a href="http://pygments.org/">pygments</a> というライブラリはかなり有名なもので、github やら trac やらが利用しているド定番。普段使ってる ruby でやるのも馬鹿らしくなり、python で書くことに。</p><p>で、えいやっと書いたら簡単すぎワロタ</p><table class="syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15</pre></div></td><td class="code"><div class="syntax"><pre><span class="c">#!/usr/bin/env python</span><br /><span class="c"># -*- coding: utf-8 -*-</span><br /><span class="kn">import</span> <span class="nn">sys</span><br /><span class="kn">import</span> <span class="nn">codecs</span><br /><span class="kn">import</span> <span class="nn">markdown</span><br /><br /><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span><br />    <span class="n">input_file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span><br />    <span class="n">text</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><br />    <span class="n">codehilite</span> <span class="o">=</span> <span class="s">&#39;codehilite(force_linenos=True, guess_lang=False, css_class=syntax)&#39;</span><br />    <span class="n">html</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;extra&#39;</span><span class="p">,</span> <span class="n">codehilite</span><span class="p">])</span><br />    <span class="k">return</span> <span class="n">html</span><br /><br /><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span><br />    <span class="k">print</span> <span class="n">convert</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span><br /></pre></div></td></tr></table> <p>使い方はこんな感じ。</p><table class="syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="syntax"><pre>python convert.py ファイル名.md &gt; ファイル名.html<br /></pre></div></td></tr></table> <p>さらに、mac には pbcopy という便利なコマンドがあり、リダイレクトやパイプでクリップボードにコピーできるのである。</p><table class="syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="syntax"><pre>python convert.py ファイル名.md | pbcopy<br /></pre></div></td></tr></table> <p>ということで、このブログのエントリは上記コマンドでコピペしたものである。</p><h2>どんな感じでハイライトするの？</h2><p>まず、markdown ではこんな風に書く。普通のコードブロックの記述に、頭に ::: を付けて、python とか ruby とか javascrtpt とか書けばOK。```でコードブロック作ってもOK。</p><pre><br />    :::python<br />    import sys<br /><br />    def hoge(fuga):<br />        fugafuga = 123<br />        print fugafuga<br />        return 'ok'<br /></pre> <p>すると、こんな感じのタグになるので、CSSで飾り付ければOK。</p><table class="syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13</pre></div></td><td class="code"><div class="syntax"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;syntaxtable&quot;</span><span class="nt">&gt;&lt;tr&gt;&lt;td</span> <span class="na">class=</span><span class="s">&quot;linenos&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">&quot;linenodiv&quot;</span><span class="nt">&gt;&lt;pre&gt;</span>1<br />2<br />3<br />4<br />5<br />6<span class="nt">&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td</span> <span class="na">class=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">&quot;syntax&quot;</span><span class="nt">&gt;&lt;pre&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;kn&quot;</span><span class="nt">&gt;</span>import<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;nn&quot;</span><span class="nt">&gt;</span>sys<span class="nt">&lt;/span&gt;</span><br /><br /><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;k&quot;</span><span class="nt">&gt;</span>def<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;nf&quot;</span><span class="nt">&gt;</span>hoge<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>(<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>fuga<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>):<span class="nt">&lt;/span&gt;</span><br /><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>fugafuga<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>=<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;mi&quot;</span><span class="nt">&gt;</span>123<span class="nt">&lt;/span&gt;</span><br /><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;k&quot;</span><span class="nt">&gt;</span>print<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;n&quot;</span><span class="nt">&gt;</span>fugafuga<span class="nt">&lt;/span&gt;</span><br /><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;k&quot;</span><span class="nt">&gt;</span>return<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;s&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;#39;</span>ok<span class="ni">&amp;#39;</span><span class="nt">&lt;/span&gt;</span><br /><span class="nt">&lt;/pre&gt;&lt;/div&gt;</span><br /><span class="nt">&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</span><br /></pre></div></td></tr></table> <p>飾り付けについては <a href="http://pygments.org/demo/">pygments のデモページ</a> でいろいろなコードでの適用例が見られるので、そこを参考に。今回は colorful を使ってみた。CSS を blogger に適用するのは、テンプレート→カスタマイズ→アドバンス→CSS から。</p><h2>まとめ</h2><p>実は blogger api 使った投稿ツールを作ろうと思って脱線した。過去ブログに関しても、じわじわと移行させる予定。あくまで予定……ｗ</p>